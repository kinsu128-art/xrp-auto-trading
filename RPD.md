# 암호화폐 백테스트 프로그램 RPD
# Requirements and Planning Document

## 1. 프로젝트 개요

### 1.1 목적
- 래리 윌리엄스(Larry Williams) 전략을 기반으로 한 암호화폐 백테스트 및 실전 자동매매 시스템 개발
- 빗썸(Bithumb) 거래소와 연동하여 자동 매매 실행
- 텔레그램 봇을 통한 실시간 매매 알림

### 1.2 범위
- 래리 윌리엄스 돌파 전략 구현
- 빗썸 API 연동
- 실전 자동매매 기능
- 매매 알림 시스템
- XRP 암호화폐 대상

---

## 2. 기능 요구사항

### 2.1 핵심 기능

#### 2.1.1 데이터 수집
- 빗썸 API에서 6시간 봉 데이터 수집 (OHLCV)
- 실시간 데이터 업데이트
- 과거 데이터 백테스트용 저장

#### 2.1.2 매매 전략 (래리 윌리엄스 인트라데이 돌파)

**돌파기준선 산식:**
```
돌파기준선 = 현재봉 종가 + (현재봉 고가 - 현재봉 저가) × 0.5
```

**매수 절차:**

1단계 - 캔들 마감 시 사전 조건 확인:
- 조건 2: `돌파기준선 > 최근 5봉 종가 평균`
- 조건 3: `전봉 거래량 < 현재봉 거래량`
- 두 조건 모두 충족 시 → 다음 봉 인트라데이 감시 시작

2단계 - 인트라데이 감시 (매 60초):
- `현재가 ≥ 돌파기준선` → 즉시 지정가 매수 주문 접수
- 봉 마감까지 미도달 시 → 감시 만료, 다음 봉에서 재판단

**매도 조건:**
- `돌파기준선 ≤ 최근 5봉 종가 평균` (조건 2 미충족) → 다음 캔들 시가에 시장가 매도
- 거래량 조건(조건 3)은 매도 판단에서 제외

#### 2.1.3 백테스트 기능
- 과거 데이터로 전략 검증
- 수익률, 승률, 최대 손실률 등 성과 지표 산출
- 매매 내역 로그 저장

#### 2.1.4 실전 자동매매
- 실시간 봉 마감 확인
- 매수 조건 충족 시 자동 매수
- 매도 조건 충족 시 자동 매도
- 거래 잔고 확인 및 수량 결정

#### 2.1.5 알림 시스템
- 텔레그램 봇을 통한 매매 알림
- 매수/매도 내역 전송
- 잔고 변화 알림

---

## 3. 비기능 요구사항

### 3.1 성능
- 4시간 봉 마감 후 1분 내에 매매 조건 검증 및 실행
- API 요청 실패 시 재시도 로직 (최대 3회)
- 시스템 응답 시간: < 5초

### 3.2 신뢰성
- 99.9% 가용성 목표
- 중단 시 알림 전송
- 에러 로그 및 모니터링

### 3.3 보안
- API 키 암호화 저장
- 거래 비밀번호 안전 관리
- 로그에 민감 정보 포함 금지

### 3.4 확장성
- 다른 거래소로의 확장 가능성 고려
- 다른 전략 추가 용이성 확보

---

## 4. 시스템 아키텍처

### 4.1 구성 요소

```
┌─────────────────┐
│   텔레그램 봇   │ ← 사용자 알림
└────────┬────────┘
         │
┌────────▼────────┐
│   메인 컨트롤러 │
└────────┬────────┘
         │
    ┌────┴────┬─────────┬────────┐
    │         │         │        │
┌───▼───┐ ┌───▼───┐ ┌───▼───┐ ┌─▼──────┐
│데이터  │ │전략   │ │주문   │ │알림    │
│수집   │ │엔진   │ │실행   │ │모듈    │
└───┬───┘ └───┬───┘ └───┬───┘ └─┬──────┘
    │         │         │        │
└───▼─────────▼─────────▼────────▼───┘
              빗썸 API
```

### 4.2 모듈 상세 설명

#### 4.2.1 데이터 수집 모듈 (Data Collector)
- 빗썸 API 연동
- 4시간 봉 OHLCV 데이터 수집
- 데이터 저장소 관리
- 실시간 데이터 업데이트

**필요한 API:**
- `/public/candlestick/{order_currency}_{payment_currency}/{chart_intervals}`

#### 4.2.2 전략 엔진 (Strategy Engine)
- 래리 윌리엄스 전략 로직 구현
- 매수 조건 검증
- 매도 타이밍 결정
- 백테스트 수행

#### 4.2.3 주문 실행 모듈 (Order Executor)
- 빗썸 API를 통한 매수/매도 주문
- 잔고 확인
- 주문 상태 모니터링
- 에러 처리 및 재시도

**필요한 API:**
- `/trade/market_buy` (시장가 매수)
- `/trade/market_sell` (시장가 매도)
- `/info/balance` (잔고 조회)

#### 4.2.4 알림 모듈 (Notification Module)
- 텔레그램 봇 연동
- 매수/매도 알림 전송
- 잔고 변화 알림
- 에러 알림

#### 4.2.5 메인 컨트롤러 (Main Controller)
- 모든 모듈 조율
- 4시간 봉 마감 감지
- 스케줄링 관리
- 로그 및 모니터링

---

## 5. 기술 사양

### 5.1 개발 환경
- **언어**: Python 3.9+
- **프레임워크**: 없음 (순수 Python 또는 간단한 구조)
- **데이터베이스**: SQLite (백테스트 데이터) 또는 CSV 파일

### 5.2 주요 라이브러리
- `requests`: API 요청
- `python-telegram-bot`: 텔레그램 봇
- `pandas`: 데이터 처리
- `schedule`: 스케줄링
- `pycryptodome`: 암호화

### 5.3 파일 구조
```
project/
├── config.py                 # 설정 (API 키, 텔레그램 토큰 등)
├── main.py                   # 메인 실행 파일
├── data_collector.py         # 데이터 수집 모듈
├── strategy_engine.py        # 전략 엔진
├── order_executor.py         # 주문 실행 모듈
├── notification.py           # 알림 모듈
├── backtester.py             # 백테스터
├── utils.py                  # 유틸리티 함수
├── logs/                     # 로그 디렉토리
├── data/                     # 데이터 저장소
└── .env                      # 환경 변수 (API 키 등)
```

### 5.4 환경 변수 (.env)
```env
BITHUMB_API_KEY=your_api_key
BITHUMB_API_SECRET=your_api_secret
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
TRADING_CURRENCY=KRW
ORDER_CURRENCY=BTC
```

---

## 6. 구현 계획

### 6.1 단계별 개발 계획

#### 단계 1: 기본 설정 및 데이터 수집 (1주)
- [ ] 프로젝트 구조 설정
- [ ] 빗썸 API 연동 및 테스트
- [ ] 4시간 봉 데이터 수집 기능 구현
- [ ] 데이터 저장 기능 구현

#### 단계 2: 전략 엔진 개발 (1주)
- [ ] 래리 윌리엄스 전략 로직 구현
- [ ] 매수 조건 검증 로직
- [ ] 매도 조건 결정 로직
- [ ] 단위 테스트 작성

#### 단계 3: 백테스트 기능 (1주)
- [ ] 백테스터 구현
- [ ] 성과 지표 계산 (수익률, 승률 등)
- [ ] 백테스트 결과 시각화
- [ ] 과거 데이터로 검증

#### 단계 4: 주문 실행 모듈 (1주)
- [ ] 빗썸 거래 API 연동
- [ ] 잔고 확인 기능
- [ ] 매수/매도 주문 실행
- [ ] 주문 상태 모니터링
- [ ] 에러 처리 및 재시도 로직

#### 단계 5: 알림 시스템 (3일)
- [ ] 텔레그램 봇 설정
- [ ] 매수/매도 알림 전송
- [ ] 잔고 변화 알림
- [ ] 에러 알림 기능

#### 단계 6: 메인 컨트롤러 및 통합 (1주)
- [ ] 4시간 봉 마감 감지 스케줄러
- [ ] 모든 모듈 통합
- [ ] 로그 및 모니터링 시스템
- [ ] 통합 테스트

#### 단계 7: 테스트 및 최적화 (1주)
- [ ] 단위 테스트
- [ ] 통합 테스트
- [ ] 시뮬레이션 테스트
- [ ] 성능 최적화
- [ ] 버그 수정

### 6.2 마일스톤
- **마일스톤 1**: 데이터 수집 완료 (단계 1 완료)
- **마일스톤 2**: 전략 구현 완료 (단계 2 완료)
- **마일스톤 3**: 백테스트 완료 (단계 3 완료)
- **마일스톤 4**: 실전 매매 기능 완료 (단계 4 완료)
- **마일스톤 5**: 알림 시스템 완료 (단계 5 완료)
- **마일스톤 6**: 전체 시스템 완료 (단계 6, 7 완료)

---

## 7. 테스트 계획

### 7.1 단위 테스트
- 전략 엔진: 각 매수 조건별 테스트
- 데이터 수집: API 연결 테스트
- 주문 실행: 시뮬레이션 환경에서 테스트

### 7.2 통합 테스트
- 모든 모듈이 함께 동작하는지 테스트
- 4시간 봉 마감 시나리오 시뮬레이션

### 7.3 백테스트
- 최소 1년치 과거 데이터로 전략 검증
- 다양한 시장 상황에서 성과 확인
- 파라미터 튜닝 (0.5 배율 등)

### 7.4 실전 테스트
- 소액으로 실전 테스트
- 1주일 동안 모니터링
- 문제점 발견 시 즉시 수정

---

## 8. 리스크 및 대응 방안

### 8.1 기술적 리스크
| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| API 장애 | 매매 불가 | 재시도 로직, 알림 전송 |
| 데이터 오류 | 잘못된 매매 | 데이터 검증 로직 |
| 시스템 다운 | 기회 비용 발생 | 모니터링, 빠른 복구 |

### 8.2 전략적 리스크
| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| 전략 실패 | 손실 발생 | 백테스트 충분히 수행, 소액 시작 |
| 시장 변동성 | 예측 불가 | 손절매 설정, 리스크 관리 |
| 거래 수수료 | 수익률 감소 | 수수료를 고려한 전략 최적화 |

### 8.3 운영적 리스크
| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| 보안 침해 | 자산 손실 | API 키 암호화, 정기적 키 교체 |
| 인적 오류 | 잘못된 설정 | 테스트 후 배포, 롤백 계획 |

---

## 9. 운영 및 유지보수

### 9.1 모니터링
- 시스템 상태 모니터링 (CPU, 메모리, 디스크)
- API 요청 모니터링
- 매매 내역 모니터링
- 에러 로그 모니터링

### 9.2 로그 관리
- 모든 매매 내역 로그 저장
- 에러 로그 상세 기록
- 일일/주간 리포트 생성

### 9.3 백업
- 거래 내역 데이터 백업
- 설정 파일 백업
- 코드 버전 관리 (Git)

### 9.4 업데이트
- 정기적인 전략 검토 및 업데이트
- 라이브러리 업데이트
- 보안 패치 적용

---

## 10. 성공 지표

### 10.1 기술적 지표
- 시스템 가용성: 99.9% 이상
- API 요청 성공률: 99% 이상
- 매매 실행 지연: 1분 이내

### 10.2 거래 지표
- 백테스트 승률: 60% 이상
- 백테스트 연간 수익률: 20% 이상
- 최대 손실률: 10% 이하

### 10.3 사용자 만족도
- 알림 도착 시간: 1분 이내
- 시스템 안정성: 99% 이상

---

## 11. 향후 개선 방향

### 11.1 전략 확장
- 다른 매매 전략 추가
- 여러 코인 동시 거래
- 복잡한 포트폴리오 관리

### 11.2 기능 확장
- 다른 거래소 지원 (업비트, 바이낸스 등)
- 더 다양한 시간봉 지원 (1시간, 4시간, 일봉 등)
- 머신러닝 기반 예측 모델 통합

### 11.3 UI/UX
- 웹 대시보드 개발
- 실시간 거래 내역 시각화
- 수동 매매 기능 추가

---

## 12. 참고 자료

### 12.1 빗썸 API 문서
- 공식 API 문서: https://apidocs.bithumb.com/

### 12.2 래리 윌리엄스 전략
- 래리 윌리엄스 돌파 전략: 0.5 배율 돌파 기준선
- 거래량 확인: 추세 확인을 위한 필터

### 12.3 텔레그램 봇
- python-telegram-bot 문서: https://docs.python-telegram-bot.org/

---

## 부록: 매매 전략 상세 설명

### 돌파기준선 산식
```
돌파기준선 = 현재봉 종가 + (현재봉 고가 - 현재봉 저가) × 0.5
```
- 방금 마감된 봉의 종가에서 해당 봉의 변동폭(고-저) × 0.5를 더한 값
- breakthrough_ratio 파라미터로 배율 조정 가능 (기본값 0.5)

### 캔들 마감 시 사전 체크 조건

**조건 2: 추세 확인 (매수/매도 모두 사용)**
```
돌파기준선 > 최근 5봉 종가 평균
```
- 현재 가격대가 최근 5봉 평균보다 높은지 확인
- 상승 추세에 있을 때만 매수 진행

**조건 3: 거래량 증가 (매수 진입 시만 사용)**
```
전봉 거래량 < 현재봉 거래량
```
- 거래량이 증가하는 강한 움직임인지 확인
- 매도 판단에서는 제외

### 인트라데이 매수 조건 (다음 봉 형성 중, 매 60초 체크)
```
현재가 ≥ 돌파기준선
```
- 조건 2 & 3 충족 후 다음 봉에서만 활성화
- 도달 시 지정가 매수 주문 즉시 접수

### 매도 조건
```
돌파기준선 ≤ 최근 5봉 종가 평균
```
- 조건 2(above_avg)만 체크, 조건 3(거래량)은 무시
- 캔들 마감 시점에 평가하여 다음 봉 시가에 시장가 매도

---

**문서 버전**: 1.0
**작성일**: 2026-02-14
**작성자**: Sisyphus AI Agent
